<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pricing - TensorMarketData</title>
  <meta name="description" content="TensorMarketData pricing plans for B2B data API access.">
  <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>
  <nav>
    <a href="/"><img src="/static/images/logo.svg" alt="TensorMarketData" height="32"/></a>
    <ul>
      <li><a href="/quickstart">Quickstart</a></li>
      <li><a href="/docs">Docs</a></li>
      <li><a href="/openapi.json">OpenAPI</a></li>
      <li><a href="/coverage">Coverage</a></li>
      <li><a href="/status">Status</a></li>
      <li><a href="/pricing" class="active">Pricing</a></li>
      <li><a href="/changelog">Changelog</a></li>
      <li><a href="/dashboard" class="cta">Get API Key</a></li>
    </ul>
  </nav>

  <section class="hero" style="padding: 4rem 2rem;">
    <h1>Simple, Transparent Pricing</h1>
    <p>Hard caps. No surprise overages. Cancel anytime.</p>
  </section>

  <section style="margin-top: -3rem;">
    <div class="container">
      <div class="pricing" id="pricing-cards">
        <p style="text-align:center;color:var(--text-2);">Loading pricing...</p>
      </div>
    </div>
  </section>

  <!-- Agent Quickstart Panel -->
  <section style="background: var(--surface-2); padding: 3rem 2rem; margin-top: 2rem;">
    <div class="container">
      <h2 style="margin-bottom: 1rem;">Agent Quickstart</h2>
      <p style="color: var(--text-2); margin-bottom: 1.5rem;">Copy this exact curl to make your first API call:</p>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
<pre>curl -sS "https://tensormarketdata.com/v1/search?q=coffee" \
  -H "Authorization: Bearer $TMD_API_KEY" \
  -H "Accept: application/json"</pre>
      </div>
      <div class="callout info" style="margin-top: 1rem;">
        <div class="callout-icon">ℹ️</div>
        <div>
          <div class="callout-title">Rate Limit Headers</div>
          <div class="callout-text">Every response includes: X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Reset</div>
        </div>
      </div>
    </div>
  </section>

  <section style="background: #f1f5f9;">
    <div class="container">
      <div class="section-title">
        <h2>Frequently Asked Questions</h2>
      </div>
      <div style="max-width: 800px; margin: 0 auto;">
        <div style="background: white; padding: 1.5rem; border-radius: 8px; margin-bottom: 1rem;">
          <h4 style="margin-bottom: 0.5rem;">What counts as a credit?</h4>
          <p style="color: var(--gray);">Each API call to /search, /supplier/{id}, or /supplier/{id}/inventory deducts 1 credit.</p>
        </div>
        <div style="background: white; padding: 1.5rem; border-radius: 8px; margin-bottom: 1rem;">
          <h4 style="margin-bottom: 0.5rem;">Can I carry over unused credits?</h4>
          <p style="color: var(--gray);">Credits reset monthly and do not carry over. Upgrade your plan if you need more capacity.</p>
        </div>
        <div style="background: white; padding: 1.5rem; border-radius: 8px;">
          <h4 style="margin-bottom: 0.5rem;">Can I cancel anytime?</h4>
          <p style="color: var(--gray);">Cancel from your dashboard at any time. You'll retain access until the end of your billing period.</p>
        </div>
      </div>
    </div>
  </section>

  <section>
    <div class="container" style="text-align: center;">
      <h2>Ready to Get Started?</h2>
      <p style="color: var(--gray); margin: 1rem 0 2rem;">Start building with TensorMarketData today</p>
      <a href="/dashboard" class="btn btn-primary">Get API Key</a>
    </div>
  </section>

  <footer>
    <p>&copy; 2026 TensorMarketData. All rights reserved.</p>
  </footer>

<script>
async function loadPricing() {
  try {
    const res = await fetch('/portal/pricing.json');
    const data = await res.json();
    const container = document.getElementById('pricing-cards');
    
    if (!data.plans || data.plans.length === 0) {
      container.innerHTML = '<p style="color:red;">Failed to load pricing</p>';
      return;
    }
    
    container.innerHTML = data.plans.map((plan, idx) => {
      const isFeatured = plan.plan_id === 'business';
      const price = plan.monthly_price_usd === 0 ? 'Free' : `$${plan.monthly_price_usd}`;
      const period = plan.monthly_price_usd === 0 ? '/forever' : '/month';
      const cta = plan.plan_id === 'free' 
        ? '<a href="/dashboard" class="btn btn-secondary" style="color: var(--dark); background: #e2e8f0;">Get Free Key</a>'
        : plan.plan_id === 'enterprise'
        ? '<a href="/contact" class="btn btn-secondary" style="color: var(--dark); background: #e2e8f0;">Contact Sales</a>'
        : `<button onclick="checkout('${plan.plan_id}')" class="btn ${isFeatured ? 'btn-primary' : 'btn-secondary'}" style="${!isFeatured ? 'color: var(--dark); background: #e2e8f0;' : ''}">Sign Up</button>`;
      
      const credits = plan.included_credits === 0 ? 'Demo only' : `${plan.included_credits.toLocaleString()} credits`;
      const rpm = plan.rate_limit?.requests_per_minute || 'N/A';
      
      return `
        <div class="pricing-card${isFeatured ? ' featured' : ''}">
          ${isFeatured ? '<span class="badge">Most Popular</span>' : ''}
          <h3>${plan.name}</h3>
          <div class="price">${price}<span>${period}</span></div>
          <ul>
            <li>${credits}/month</li>
            <li>${rpm} requests/minute</li>
            ${plan.features?.map(f => `<li>${f}</li>`).join('') || ''}
          </ul>
          ${cta}
        </div>
      `;
    }).join('');
  } catch (err) {
    console.error('Pricing load error:', err);
    document.getElementById('pricing-cards').innerHTML = '<p style="color:red;">Failed to load pricing</p>';
  }
}

async function checkout(plan) {
  try {
    const response = await fetch('/v1/payments/subscription', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ plan: plan }),
      credentials: 'include'
    });
    
    const data = await response.json();
    
    if (data.url) {
      window.location.href = data.url;
    } else if (response.status === 401) {
      alert('Please sign in to upgrade your plan');
      window.location.href = '/login?redirect=/pricing';
    } else {
      alert('Error: ' + (data.detail?.error || 'Something went wrong. Please try again.'));
    }
  } catch (error) {
    console.error('Checkout error:', error);
    alert('Please sign in to upgrade your plan');
    window.location.href = '/login?redirect=/pricing';
  }
}

function copyCode(btn) {
  const code = btn.nextElementSibling.textContent;
  navigator.clipboard.writeText(code);
  btn.textContent = 'Copied!';
  setTimeout(() => btn.textContent = 'Copy', 2000);
}

// Run when DOM is ready
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', loadPricing);
} else {
  loadPricing();
}
</script>
</body>
</html>
