{% extends "base_app.html" %}
{% block title %}Dashboard - TensorMarketData{% endblock %}
{% block content %}
<div class="container section">
<div class="h1">Welcome, {{ business.name if business else "Client" }}</div>

{% if onboarding_steps %}
<div class="card pad" style="margin-bottom:16px">
 <div class="h2" style="margin-bottom:12px">Onboarding checklist</div>
 <div style="display:grid;gap:8px">
  {% if not business.gbp_connected %}
  <div style="display:flex;align-items:center;gap:10px">
   <span style="color:#ffc107">☐</span>
   <span>Connect Google Business Profile</span>
   <a href="/app/settings" style="margin-left:auto" class="btn small">Connect</a>
  </div>
  {% else %}
  <div style="display:flex;align-items:center;gap:10px">
   <span style="color:#4caf50">☑</span>
   <span>Google Business Profile connected</span>
  </div>
  {% endif %}
  
  {% if not business.approval_email %}
  <div style="display:flex;align-items:center;gap:10px">
   <span style="color:#ffc107">☐</span>
   <span>Confirm approval routing (1–3★)</span>
   <a href="/app/settings" style="margin-left:auto" class="btn small">Set up</a>
  </div>
  {% else %}
  <div style="display:flex;align-items:center;gap:10px">
   <span style="color:#4caf50">☑</span>
   <span>Approval email confirmed</span>
  </div>
  {% endif %}
  
  {% if not business.go_live %}
  <div style="display:flex;align-items:center;gap:10px">
   <span style="color:#ffc107">☐</span>
   <span>Go Live</span>
   <a href="/app/settings" style="margin-left:auto" class="btn small">Enable</a>
  </div>
  {% else %}
  <div style="display:flex;align-items:center;gap:10px">
   <span style="color:#4caf50">☑</span>
   <span>System is live</span>
  </div>
  {% endif %}
 </div>
</div>
{% endif %}

<div class="stats mt-4">
<div class="stat">
<div class="stat-num">{{ stats.total_reviews or 0 }}</div>
<div class="stat-label">Total Reviews</div>
</div>
<div class="stat">
<div class="stat-num">{{ stats.avg_rating|default("0.0") }}</div>
<div class="stat-label">Avg Rating</div>
</div>
<div class="stat">
<div class="stat-num">{{ stats.pending_approval or 0 }}</div>
<div class="stat-label">Pending Approval</div>
</div>
<div class="stat">
<div class="stat-num">{{ stats.replied|default(0) }}</div>
<div class="stat-label">Replied</div>
</div>
</div>

<div class="grid2 mt-4">
<div class="card pad">
<div class="h2">Recent Reviews</div>
{% if recent_reviews %}
<div class="table-wrap">
<table>
<tr><th>Rating</th><th>Review</th><th>Status</th></tr>
{% for r in recent_reviews %}
<tr>
<td>{% for i in range(r.rating) %}★{% endfor %}</td>
<td>{{ r.comment[:60] }}...</td>
<td>
{% if r.status=='posted' %}<span class="badge green">Posted</span>
{% elif r.status=='needs_approval' %}<span class="badge yellow">Pending</span>
{% else %}<span class="badge blue">{{ r.status }}</span>{% endif %}
</td>
</tr>
{% endfor %}
</table>
</div>
{% else %}
<p class="muted">No reviews yet.</p>
{% endif %}
</div>

<div class="card pad">
<div class="h2">Quick Actions</div>
<div style="display:flex;flex-direction:column;gap:8px">
<a href="/app/reviews" class="btn ghost block">View All Reviews</a>
<a href="/app/approvals" class="btn ghost block">Review Approvals</a>
<a href="/app/settings" class="btn ghost block">Settings</a>
</div>
</div>
</div>
</div>
{% endblock %}
