# TensorMarketData Alerting Configuration

## PagerDuty Integration

**Service ID**: `{{PAGERDUTY_SERVICE_ID}}`

**Escalation Policy**: Engineering On-Call

## Alert Channels

| Priority | Channel | Purpose |
|----------|---------|---------|
| P1 (Critical) | PagerDuty + Slack #alerts-critical | Immediate response |
| P2 (High) | Slack #alerts + SMS | Same-day response |
| P3 (Medium) | Slack #alerts | Next business day |
| P4 (Low) | Email | Weekly digest |

---

## Critical Alerts (P1)

```yaml
- name: "High API Error Rate"
  condition: "error_rate > 5% for 5 minutes"
  severity: critical
  channels: [pagerduty, slack-critical]
  runbook: "https://wiki/runbooks/api-errors"
  
- name: "Service Outage"
  condition: "uptime < 99% for 10 minutes"
  severity: critical
  channels: [pagerduty, slack-critical]
  runbook: "https://wiki/runbooks/outage"
  
- name: "Failed Payments Spike"
  condition: "payment_failure_rate > 10%"
  severity: critical
  channels: [pagerduty, finance-slack]
  runbook: "https://wiki/runbooks/payments"
  
- name: "Data Breach Detection"
  condition: "anomalous_data_access_detected"
  severity: critical
  channels: [pagerduty, security-slack]
  runbook: "https://wiki/runbooks/security"
  
- name: "MRR Drop"
  condition: "MRR decrease > 20% day-over-day"
  severity: critical
  channels: [pagerduty, ceo-slack]
  runbook: "https://wiki/runbooks/revenue-drop"
```

---

## High Priority Alerts (P2)

```yaml
- name: "High Latency"
  condition: "p95_latency > 1000ms for 15 minutes"
  severity: high
  channels: [slack-alerts, sms]
  runbook: "https://wiki/runbooks/latency"
  
- name: "Database Connection Pool Exhaustion"
  condition: "db_connections > 90% capacity"
  severity: high
  channels: [slack-alerts, sms]
  runbook: "https://wiki/runbooks/database"
  
- name: "Churn Spike"
  condition: "daily_churn > 10% vs 7-day avg"
  severity: high
  channels: [slack-growth]
  runbook: "https://wiki/runbooks/churn"
  
- name: "CAC Spike"
  condition: "CAC > 2x monthly average"
  severity: high
  channels: [slack-growth]
  runbook: "https://wiki/runbooks/cac"
  
- name: "Signup Anomaly"
  condition: "signup_rate < 50% or > 200% of normal"
  severity: high
  channels: [slack-growth]
  runbook: "https://wiki/runbooks/signups"
```

---

## Medium Priority Alerts (P3)

```yaml
- name: "Low DAU Growth"
  condition: "DAU growth < -10% week-over-week"
  severity: medium
  channels: [slack-growth]
  
- name: "API Key Creation Drop"
  condition: "api_key_creation < 70% of normal"
  severity: medium
  channels: [slack-growth]
  
- name: "First Query Rate Decline"
  condition: "first_query_rate < 30% (was > 40%)"
  severity: medium
  channels: [slack-product]
  
- name: "NPS Drop"
  condition: "NPS < 30 (was > 50)"
  severity: medium
  channels: [slack-product]
  
- name: "Storage Near Limit"
  condition: "disk_usage > 80%"
  severity: medium
  channels: [slack-alerts]
```

---

## Low Priority Alerts (P4)

```yaml
- name: "Weekly Report Delay"
  condition: "report not generated by 10am"
  severity: low
  channels: [email]
  
- name: "Dashboard Stale"
  condition: "data not updated for 2 hours"
  severity: low
  channels: [email]
  
- name: "Minor Feature Usage Decline"
  condition: "feature_adoption < -20% month-over-month"
  severity: low
  channels: [email]
```

---

## Alert Thresholds Reference

| Metric | Warning | Critical |
|--------|---------|----------|
| API Error Rate | >2% | >5% |
| Latency p95 | >500ms | >1000ms |
| Uptime | <99.9% | <99.5% |
| DAU Change | -10% | -20% |
| MRR Change | -5% | -10% |
| Churn Rate | >5% | >8% |
| CAC Increase | +25% | +50% |
| Signup Rate | -25% | -50% |

---

## Alert Cooldowns

```yaml
cooldowns:
  error_rate: 15 minutes
  latency: 30 minutes
  churn: 24 hours
  signup_anomaly: 1 hour
  revenue_drop: 6 hours
```

---

## On-Call Schedule

| Week | Primary | Secondary |
|------|---------|-----------|
| Current | Engineer on-call | Engineering manager |
| +1 week | Engineer on-call | Engineering manager |
| +2 weeks | Engineer on-call | Engineering manager |

---

## Escalation Path

```
Alert Triggered
    ↓
Slack Channel
    ↓ (no ack in 5 min)
SMS to Primary
    ↓ (no ack in 10 min)
SMS to Secondary
    ↓ (no ack in 15 min)
PagerDuty Auto-Escalation
```
